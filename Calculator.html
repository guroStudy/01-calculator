<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        border: 0;
        margin: 0;
        box-sizing: border-box;
      }

      body {
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      #app {
        padding: 2rem;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0px 0px 10px #eee, 0px 0px 15px #ccc, 0px 0px 20px #bbb;
      }
      .calculator {
        display: flex;
        flex-direction: column;
        width: 300px;
        height: 400px;
      }

      .calculator__view__wrapper {
        display: flex;
        flex-direction: column;
        padding: 1em 0;
      }
      .calculator__view {
        height: 2.5rem;
        background-color: rgba(1, 83, 83, 0.712);
        color: #fff;
        padding: 0 1em;
        text-align: right;
        font-size: 1rem;
      }

      .calculator__view:last-child {
        margin-bottom: 10px;
      }

      .calculator__btns {
        flex: 1;
        display: grid;
        grid-gap: 10px;
        grid-template-columns: repeat(4, 1fr);
      }
      .calculator__btns__btn {
        border: 0;
        font-size: 1.5rem;
        background-color: #fff;
        box-shadow: inset 0px 0px 50px #eeeeee,
          inset 0px 0px 30px rgba(215, 233, 235, 0.623);
        border-radius: 5px;
      }
      .calculator__btns [value="C"] {
        grid-area: 1/1/2/3; /*rowStart/columnStart/rowEnd/columnEnd*/
        box-shadow: inset 0px 0px 100px rgb(222, 223, 214);
      }
      .calculator__btns [value="="] {
        grid-area: 5/3/6/5;
      }
      .calculator__btns__btn:hover {
        cursor: pointer;
        box-shadow: none;
        background-color: rgb(223, 241, 241);
        border: 0;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <script>
      //index.js
      const app = document.getElementById("app");
      const calculator = new Calculator(app);

      //calculator.js
      function Calculator(target) {
        this.target = target;
        this.result = 0;
        this.equation = "";

        const makeCalculatorFrame = (target) => {
          const calculator = document.createElement("div");
          calculator.className = "calculator";
          target.append(calculator);
          return calculator;
        };

        const makeViews = (target) => {
          const views = document.createElement("div");
          views.className = "calculator__view__wrapper";
          views.innerHTML = `
                        <input type="text" class="calculator__view calculator__view__equation" disabled>
                        <input type="text" class="calculator__view calculator__view__result" disabled>
                      `;

          target.append(views);
          return views;
        };

        const makeBtns = (target) => {
          const btns = document.createElement("div");
          btns.className = "calculator__btns";
          btns.innerHTML = `
                        <button class="calculator__btns__btn type="button" value = 'C' class="allClear">AC</button>
                        <button class="calculator__btns__btn type="button" value = 'delete'>del</button>
                        <button class="calculator__btns__btn type="button" value = '/'>&divide</button>
                        <button class="calculator__btns__btn type="button" value = 7>7</button>
                        <button class="calculator__btns__btn type="button" value = 8>8</button>
                        <button class="calculator__btns__btn type="button" value = 9>9</button>
                        <button class="calculator__btns__btn type="button" value = '*'>&times</button>
                        <button class="calculator__btns__btn type="button" value = 4>4</button>
                        <button class="calculator__btns__btn type="button" value = 5>5</button>
                        <button class="calculator__btns__btn type="button" value = 6>6</button>
                        <button class="calculator__btns__btn type="button" value = '-'>-</button>
                        <button class="calculator__btns__btn type="button" value = 1>1</button>
                        <button class="calculator__btns__btn type="button" value = 2>2</button>
                        <button class="calculator__btns__btn type="button" value = 3>3</button>
                        <button class="calculator__btns__btn type="button" value = '+'>+</button>
                        <button class="calculator__btns__btn type="button" value = '.'>.</button>
                        <button class="calculator__btns__btn type="button" value = 0>0</button>
                        <button class="calculator__btns__btn type="button" value = '='>=</button>
                        `;
          target.append(btns);
          return btns;
        };

        const makeCalculator = () => {
          this.calculatorEl = makeCalculatorFrame(this.target);
          this.viewsEl = makeViews(this.calculatorEl);
          this.btnsEl = makeBtns(this.calculatorEl);
        };

        const initDatas = () => {
          // define views data
          const views = Array.from(
            document.querySelectorAll(".calculator__view")
          );
          this.views = {
            equation: views[0],
            result: views[1],
          };

          // define btn datas
          this.btns = Array.from(this.btnsEl.children);

          this.numBtns = this.btns.filter((item) => item.value <= 10);
          this.operatorBtns = this.btns.filter((item) =>
            ["*", "/", "-", "+"].includes(item.value)
          );
          this.dotBtn = this.btns.filter((item) => item.value === ".")[0];
          this.acBtn = this.btns.filter((item) => item.value === "C")[0];
          this.deleteBtn = this.btns.filter(
            (item) => item.value === "delete"
          )[0];
          this.equalBtn = this.btns.filter((item) => item.value === "=")[0];

          this.btns = {
            numBtns: this.numBtns,
            operatorBtns: this.operatorBtns,
            dotBtn: this.dotBtn,
            deleteBtn: this.deleteBtn,
            acBtn: this.acBtn,
            equalBtn: this.eqaulBtn,
          };

          //define value/operator storage
          this.values = [];
          this.operators = [];
        };

        // calculate
        const calculate = (operator, before, after) => {
          switch (operator) {
            case "+":
              return before + after;
            case "-":
              return before - after;
            case "*":
              return before * after;
            case "/":
              return before / after;
          }
        };

        // handle datas
        const logData = () => {
          console.log(this.values);
          console.log(this.operators);
          console.log(this.currentValue);
        };

        const setCurrentValue = (value) => {
          this.currentValue = value;
          logData();
        };

        const appendToCurrentValue = (value) => {
          this.currentValue
            ? (this.currentValue += value)
            : setCurrentValue(value);
          logData();
        };

        const pushToValues = (value) => {
          if (value) {
            this.values.push(value);
          } else {
            throw new Error("push valid value to valueStorage");
          }
        };

        const pushToOperators = (value) => {
          this.operators.push(value);
          logData();
        };

        this.getLastCharOfEquation = () => this.views.equation.value.slice(-1);

        // set views

        this.setViewFontSize = (fontSize) => {
          Object.values(this.views).forEach(
            (i) => (i.style.fontSize = fontSize)
          );
        };

        const appendToEquationValue = (value) => {
          this.views.equation.value += value;
        };
        const setEquationValue = (value) => {
          this.views.equation.value = value;
        };
        const setResultValue = (value) => {
          this.views.result.value = value;
        };

        const reset = () => {
          this.values = [];
          this.operators = [];
          setCurrentValue("");
          setEquationValue("");
          setResultValue("0");
        };

        this.init = () => {
          makeCalculator();
          initDatas();
          console.log(this.views);

          this.numBtns.forEach((numBtn) => {
            numBtn.addEventListener("click", () => {
              appendToEquationValue(numBtn.value);
              appendToCurrentValue(numBtn.value);
            });
          });

          this.operatorBtns.forEach((operatorBtn) => {
            operatorBtn.addEventListener("click", () => {
              appendToEquationValue(operatorBtn.value);
              pushToOperators(operatorBtn.value);
              this.currentValue && pushToValues(this.currentValue);
              setCurrentValue(undefined);
            });
          });

          this.dotBtn.addEventListener("click", (e) => {
            appendToEquationValue(e.target.value);
            appendToCurrentValue(e.target.value);
          });

          this.deleteBtn.addEventListener("click", (e) => {
            if (
              this.getLastCharOfEquation() <= 10 ||
              this.getLastCharOfEquation() === "."
            ) {
              setCurrentValue(
                this.currentValue
                  ? this.currentValue.slice(0, -1)
                  : this.values.pop()
              );
            } else {
              if (
                !this.currentValue &&
                this.views.equation.value.slice(-2, -1) <= 10
              ) {
                this.currentValue = this.values.pop();
              }
              this.operators.pop();
            }
            setEquationValue(this.views.equation.value.slice(0, -1));
            logData();
          });

          this.acBtn.addEventListener("click", (e) => {
            reset();
          });

          this.equalBtn.addEventListener("click", () => {
            let tempValues = [
              ...this.values,
              this.currentValue ? this.currentValue : 0,
            ].map((i) => parseFloat(i));
            let tempOperators = [...this.operators];

            while (tempValues.length <= tempOperators.length) {
              tempOperators.pop();
              logData();
              console.log(tempValues);
            }
            console.log(tempOperators);

            tempOperators.forEach((operator, i) => {
              // first, calculate * and /
              if (["*", "/"].includes(operator)) {
                tempValues[i + 1] = calculate(
                  operator,
                  tempValues[i],
                  tempValues[i + 1]
                );
                tempValues[i] = 0;
                console.log(tempValues);
                // if '-'' operator, convert to negative number
              } else if (operator === "-") {
                tempValues[i + 1] = -tempValues[i + 1];
              }
            });
            console.log(tempOperators);
            console.log(tempValues);
            console.log(this.currentValue);
            this.views.result.value = tempValues
              .filter(Boolean) // check truthy value
              .reduce((accumulator, current) => (accumulator += current), 0);
          });
        };
      }
      calculator.init();
    </script>
  </body>
</html>
